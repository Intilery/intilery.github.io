"use strict";(self.webpackChunkintilery=self.webpackChunkintilery||[]).push([[718],{5069:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"guides/marketing-preferences-hosting","title":"Hosting your own Marketing Preferences page","description":"If you want to host and brand your marketing preferences page yourself, then you","source":"@site/docs/guides/marketing-preferences-hosting.md","sourceDirName":"guides","slug":"/guides/marketing-preferences-hosting","permalink":"/docs/guides/marketing-preferences-hosting","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"marketing-preferences-hosting","title":"Hosting your own Marketing Preferences page","sidebar_label":"Self Hosting"},"sidebar":"guides","previous":{"title":"Intilery Hosted","permalink":"/docs/guides/marketing-preferences"}}');var t=r(4848),i=r(8453);const a={id:"marketing-preferences-hosting",title:"Hosting your own Marketing Preferences page",sidebar_label:"Self Hosting"},c="Self Hosting Marketing Preferences",o={},d=[{value:"What your page will need to do",id:"what-your-page-will-need-to-do",level:2},{value:"Generating the Subscription ID",id:"generating-the-subscription-id",level:2},{value:"Reading the Subscription ID",id:"reading-the-subscription-id",level:3},{value:"Reading the Asset ID / UTM Campaign",id:"reading-the-asset-id--utm-campaign",level:3},{value:"Retrieving marketing preferences for the customer",id:"retrieving-marketing-preferences-for-the-customer",level:2},{value:"HTTP endpoint",id:"http-endpoint",level:3},{value:"Example response",id:"example-response",level:3},{value:"Update the marketing preferences for the customer",id:"update-the-marketing-preferences-for-the-customer",level:2},{value:"HTTP endpoint",id:"http-endpoint-1",level:3},{value:"Tracking Unsubscribes by Campaign",id:"tracking-unsubscribes-by-campaign",level:3},{value:"Example code",id:"example-code",level:3},{value:"Example response",id:"example-response-1",level:3},{value:"Unsubscribing from all communications",id:"unsubscribing-from-all-communications",level:2}];function l(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"self-hosting-marketing-preferences",children:"Self Hosting Marketing Preferences"})}),"\n",(0,t.jsx)(n.p,{children:"If you want to host and brand your marketing preferences page yourself, then you\nneed to edit the link in the email. We'd recommend you create a standard row\ncontaining the link so you can drag and drop it in for each email you build rather\nthan editing the link each time."}),"\n",(0,t.jsx)(n.h2,{id:"what-your-page-will-need-to-do",children:"What your page will need to do"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Retrieve marketing preferences for the customer from the Intilery endpoint"}),"\n",(0,t.jsx)(n.li,{children:"Update the marketing preferences for the customer by building a new preferences object and POSTing to our endpoint"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"generating-the-subscription-id",children:"Generating the Subscription ID"}),"\n",(0,t.jsxs)(n.p,{children:["The default page is hosted by Intilery ",(0,t.jsx)(n.a,{href:"https://marketingprefs.intilery.com/content?s=aW50aWxlcnk6bWFya2V0aW5nOjg1MWZlMjM1LWY3MTEtNGVkZS05N2ZkLWFhOWUxNWIzOTg0YQ==",children:"(see example here)"}),":"]}),"\n",(0,t.jsxs)(n.p,{children:["We pass a customer specific ",(0,t.jsx)(n.strong,{children:"Subscription ID"})," as a parameter on the\nquerystring (",(0,t.jsx)(n.code,{children:"s"}),").  For custom hosting, this parameter can be named as desired.\nThe merge tag for a customer's ",(0,t.jsx)(n.em,{children:"subscription id"})," is:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-freemarker",children:'${(customer._subscriptionId)!""}\n'})}),"\n",(0,t.jsx)(n.p,{children:"So the link above is generated using:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-freemarker",children:'https://marketingprefs.intilery.com/content?s=${(customer._subscriptionId)!""}\n'})}),"\n",(0,t.jsx)(n.p,{children:"For self-hosting replace with the URL with your own hosted page."}),"\n",(0,t.jsxs)(n.p,{children:["The URL ",(0,t.jsx)(n.code,{children:"s"})," parameter name can be changed to suit,\nbut the merge tag ",(0,t.jsx)(n.strong,{children:"must"})," remain the same as this property of the\ncustomer cannot be renamed."]}),"\n",(0,t.jsxs)(n.p,{children:["When you have replaced the link with ",(0,t.jsx)(n.code,{children:"your-domain"})," Intilery will embed the link in the\nemail with appropriate UTM tracking parameters, e.g."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-http",metastring:"request",children:"https://your-domain.com/marketing-preferences/<subscriptionId>?utm_campaign=MyCampaign&utm_medium=email&utm_source=Intilery\n"})}),"\n",(0,t.jsx)(n.h3,{id:"reading-the-subscription-id",children:"Reading the Subscription ID"}),"\n",(0,t.jsx)(n.p,{children:"e.g. If the link to your marketing preferences page is:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-freemarker",children:'https://your-domain.com/marketing-preferences/${(customer._subscriptionId)!""}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["you can read the ",(0,t.jsx)(n.code,{children:"subscriptionId"})," with some JavaScript:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"window.location.href.split('/')[window.location.href.split('/').length-1]\n"})}),"\n",(0,t.jsx)(n.p,{children:"or if the link to you marketing preferences page is:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-freemarker",children:'https://your-domain.com/marketing-preferences?s=${(customer._subscriptionId)!""}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["you can read the ",(0,t.jsx)(n.code,{children:"subscriptionId"})," with this JavaScript:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"new URLSearchParams(window.location.search).get('s')\n"})}),"\n",(0,t.jsx)(n.h3,{id:"reading-the-asset-id--utm-campaign",children:"Reading the Asset ID / UTM Campaign"}),"\n",(0,t.jsxs)(n.p,{children:["Retrieve the asset ID for the campaign by reading it from the ",(0,t.jsx)(n.code,{children:"utm_campaign"})," search parameter:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"new URLSearchParams(window.location.search).get('utm_campaign')\n"})}),"\n",(0,t.jsx)(n.h2,{id:"retrieving-marketing-preferences-for-the-customer",children:"Retrieving marketing preferences for the customer"}),"\n",(0,t.jsxs)(n.p,{children:['A single endpoint returns the customers marketing preferences with the list of\nknown channels and subscription categories. Note that channels are "opt-in" and\ncategories are "opt-out".  If a new subscription category is added, the default\nstatus of that category for the customer will be ',(0,t.jsx)(n.em,{children:"subscribed"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"http-endpoint",children:"HTTP endpoint"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-http",metastring:"request",children:"GET https://events.intilery.com/cdp/marketing-preferences/<subscriptionId>\n"})}),"\n",(0,t.jsx)(n.p,{children:"For example..."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-http",metastring:"request",children:"GET https://events.intilery.com/cdp/marketing-preferences/276db9bf-ac46-4dc3-bb7d-e94a7eb1de51\n"})}),"\n",(0,t.jsx)(n.h3,{id:"example-response",children:"Example response"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n    "writeKey": "ZXhhbXBsZTpleGFtcGxlOkVYQU1QTEU=",\n    "customerId": "276db9bf-ac46-4dc3-bb7d-e94a7eb1de51",\n    "channels": [{\n        "channel": "email",\n        "name": "Email",\n        "subscribed": true\n    }, {\n        "channel": "sms",\n        "name": "SMS",\n        "subscribed": false\n    }],\n    "categories": [{\n        "category": "marketing tricks",\n        "name": "marketing_tricks",\n        "subscribed": true\n    }, {\n        "category": "new product alerts",\n        "name": "new_product_alerts",\n        "subscribed": true\n    }],\n    "unsubscribeAll": false\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"update-the-marketing-preferences-for-the-customer",children:"Update the marketing preferences for the customer"}),"\n",(0,t.jsx)(n.h3,{id:"http-endpoint-1",children:"HTTP endpoint"}),"\n",(0,t.jsx)(n.p,{children:"The same endpoint used to retrieve the customer marketing preferences is also used to update. Only the method is different."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-http",metastring:"request",children:"POST https://events.intilery.com/cdp/marketing-preferences/<subscription id>?assetId=<campaign name>\n"})}),"\n",(0,t.jsx)(n.h3,{id:"tracking-unsubscribes-by-campaign",children:"Tracking Unsubscribes by Campaign"}),"\n",(0,t.jsxs)(n.p,{children:["The parameter ",(0,t.jsx)(n.code,{children:"assetId"})," is optional, but recommended. Pass this back to Intilery to\nensure that unsubscribes are attributed to the right campaign."]}),"\n",(0,t.jsx)(n.h3,{id:"example-code",children:"Example code"}),"\n",(0,t.jsx)(n.p,{children:"The example POST below updates the example customers marketing preferences as follows:-"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Unsubscribe from the new_product_alerts subscription category"}),"\n",(0,t.jsx)(n.li,{children:"Subscribe to the SMS channel\nNote that the category/channel fields match up to those in the retrieved preferences.\nWe recommend calling this endpoint from your servers to avoid any browser related CORS or blocking issues."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'const data = {\n    "categories": [{\n        "category": "marketing_tricks",\n        "subscribed": true\n    }, {\n        "category": "new_product_alerts",\n        "subscribed": false\n    }],\n    "channels": [{\n        "channel": "email",\n        "subscribed": true\n    }, {\n        "channel": "sms",\n        "subscribed": true\n    }],\n    "unsubscribeAll": false,\n    "unsubscribeReason": ""\n};\n$.ajax({\n    type: \'POST\',\n    url: `https://events.intilery.com/cdp/marketing-preferences/276db9bf-ac46-4dc3-bb7d-e94a7eb1de51?assetId=MyCampaign`,\n    crossDomain: true,\n    contentType: \'application/json; charset=utf-8\',\n    data: JSON.stringify(data),\n    success: function () {\n        alert("marketing preferences updated");\n    }\n});\n'})}),"\n",(0,t.jsx)(n.h3,{id:"example-response-1",children:"Example response"}),"\n",(0,t.jsx)(n.p,{children:"The endpoint will return a 200 response to indicate success."}),"\n",(0,t.jsx)(n.h2,{id:"unsubscribing-from-all-communications",children:"Unsubscribing from all communications"}),"\n",(0,t.jsx)(n.p,{children:"Send the following data to the endpoint"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json5",children:'{\n    "categories": [],\n    "channels": [],\n    "unsubscribeAll": true,\n    "unsubscribeReason": "" // can be set to a string value to be recorded against the customer for your own records\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>c});var s=r(6540);const t={},i=s.createContext(t);function a(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);