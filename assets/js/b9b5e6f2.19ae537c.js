(self.webpackChunkintilery=self.webpackChunkintilery||[]).push([[5978],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return p},kt:function(){return d}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=r.createContext({}),l=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,s=e.originalType,c=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),m=l(n),d=a,g=m["".concat(c,".").concat(d)]||m[d]||u[d]||s;return n?r.createElement(g,i(i({ref:t},p),{},{components:n})):r.createElement(g,i({ref:t},p))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var s=n.length,i=new Array(s);i[0]=m;var o={};for(var c in t)hasOwnProperty.call(t,c)&&(o[c]=t[c]);o.originalType=e,o.mdxType="string"==typeof e?e:a,i[1]=o;for(var l=2;l<s;l++)i[l]=n[l];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},9434:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return i},contentTitle:function(){return o},metadata:function(){return c},toc:function(){return l},default:function(){return u}});var r=n(2122),a=n(9756),s=(n(7294),n(3905)),i={id:"marketing-preferences-hosting",title:"Hosting your own Marketing Preferences page",sidebar_label:"Hosting"},o="Marketing Preferences Hosting",c={unversionedId:"guides/marketing-preferences-hosting",id:"guides/marketing-preferences-hosting",isDocsHomePage:!1,title:"Hosting your own Marketing Preferences page",description:"Intilery host a basic marketing preferences page which is linked to in all of our",source:"@site/docs/guides/marketing-preferences-hosting.md",sourceDirName:"guides",slug:"/guides/marketing-preferences-hosting",permalink:"/docs/guides/marketing-preferences-hosting",version:"current",frontMatter:{id:"marketing-preferences-hosting",title:"Hosting your own Marketing Preferences page",sidebar_label:"Hosting"},sidebar:"guides",previous:{title:"Validate Schemas",permalink:"/docs/guides/validate-schema"}},l=[{value:"Page URL",id:"page-url",children:[]},{value:"Retrieving marketing preferences for the customer",id:"retrieving-marketing-preferences-for-the-customer",children:[{value:"Request endpoint",id:"request-endpoint",children:[]},{value:"Example response",id:"example-response",children:[]}]},{value:"Update the marketing preferences for the customer",id:"update-the-marketing-preferences-for-the-customer",children:[{value:"Request endpoint",id:"request-endpoint-1",children:[]},{value:"Example code",id:"example-code",children:[]},{value:"Campaign Reporting",id:"campaign-reporting",children:[]},{value:"Example response",id:"example-response-1",children:[]}]},{value:"Unsubscribing from all communications",id:"unsubscribing-from-all-communications",children:[]}],p={toc:l};function u(e){var t=e.components,n=(0,a.Z)(e,["components"]);return(0,s.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"marketing-preferences-hosting"},"Marketing Preferences Hosting"),(0,s.kt)("p",null,"Intilery host a basic marketing preferences page which is linked to in all of our\nemail communications.  This can be used by the customer to subscribe or opt out\nof communications based on communication medium (channel) or subscription\ncategory (interests)."),(0,s.kt)("p",null,"If a custom version of this page is required, it can be self-hosted."),(0,s.kt)("h1",{id:"what-the-page-will-need-to-do"},"What the page will need to do"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Retrieve marketing preferences for the customer from the Intilery endpoint"),(0,s.kt)("li",{parentName:"ul"},"Update the marketing preferences for the customer by building a new preferences object and POSTing to our endpoint")),(0,s.kt)("h2",{id:"page-url"},"Page URL"),(0,s.kt)("p",null,"The default page is hosted by Intilery ",(0,s.kt)("a",{parentName:"p",href:"https://marketingprefs.intilery.com/content?s=aW50aWxlcnk6bWFya2V0aW5nOjg1MWZlMjM1LWY3MTEtNGVkZS05N2ZkLWFhOWUxNWIzOTg0YQ=="},"(see example here)"),":"),(0,s.kt)("p",null,"We pass a customer specific ",(0,s.kt)("strong",{parentName:"p"},"Subscription ID")," as a parameter on the\nquerystring (",(0,s.kt)("inlineCode",{parentName:"p"},"s"),").  For custom hosting, this parameter can be named as desired.\nThe merge tag for a customer's ",(0,s.kt)("em",{parentName:"p"},"subscription id")," is:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-freemarker"},'{(customer._subscriptionId)!""}\n')),(0,s.kt)("p",null,"So the link above is generated using:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-freemarker"},'https://marketingprefs.intilery.com/content?s={(customer._subscriptionId)!""}\n')),(0,s.kt)("p",null,"For self-hosting replace with the URL with your own hosted page.  "),(0,s.kt)("p",null,"The URL ",(0,s.kt)("inlineCode",{parentName:"p"},"s")," parameter name can be changed to suit,\nbut the merge tag ",(0,s.kt)("strong",{parentName:"p"},"must")," remain the same as this property of the\ncustomer cannot be renamed."),(0,s.kt)("p",null,"e.g. If the link to your marketing preferences page is:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-freemarker"},'https://your-domain.com/marketing-preferences/{(customer._subscriptionId)!""}\n')),(0,s.kt)("p",null,"you can read the ",(0,s.kt)("inlineCode",{parentName:"p"},"subscriptionId")," with some JavaScript:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"window.location.href.split('/')[window.location.href.split('/').length-1]\n")),(0,s.kt)("p",null,"or if the link to you marketing preferences page is:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-freemarker"},'https://your-domain.com/marketing-preferences?s={(customer._subscriptionId)!""}\n')),(0,s.kt)("p",null,"you can read the ",(0,s.kt)("inlineCode",{parentName:"p"},"subscriptionId")," with this JavaScript:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"new URLSearchParams(window.location.search).get('s')\n")),(0,s.kt)("h2",{id:"retrieving-marketing-preferences-for-the-customer"},"Retrieving marketing preferences for the customer"),(0,s.kt)("p",null,'A single endpoint returns the customers marketing preferences with the list of\nknown channels and subscription categories. Note that channels are "opt-in" and\ncategories are "opt-out".  If a new subscription category is added, the default\nstatus of that category for the customer will be ',(0,s.kt)("em",{parentName:"p"},"subscribed"),"."),(0,s.kt)("h3",{id:"request-endpoint"},"Request endpoint"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-http",metastring:"request",request:!0},"GET https://events.intilery.com/cdp/marketing-preferences/<subscriptionId>\n")),(0,s.kt)("p",null,"For example..."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-http",metastring:"request",request:!0},"GET https://events.intilery.com/cdp/marketing-preferences/276db9bf-ac46-4dc3-bb7d-e94a7eb1de51\n")),(0,s.kt)("h3",{id:"example-response"},"Example response"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "writeKey": "ZXhhbXBsZTpleGFtcGxlOkVYQU1QTEU=",\n    "customerId": "276db9bf-ac46-4dc3-bb7d-e94a7eb1de51",\n    "channels": [{\n        "channel": "email",\n        "name": "Email",\n        "subscribed": true\n    }, {\n        "channel": "sms",\n        "name": "SMS",\n        "subscribed": false\n    }],\n    "categories": [{\n        "category": "marketing tricks",\n        "name": "marketing_tricks",\n        "subscribed": true\n    }, {\n        "category": "new product alerts",\n        "name": "new_product_alerts",\n        "subscribed": true\n    }],\n    "unsubscribeAll": false\n}\n')),(0,s.kt)("h2",{id:"update-the-marketing-preferences-for-the-customer"},"Update the marketing preferences for the customer"),(0,s.kt)("h3",{id:"request-endpoint-1"},"Request endpoint"),(0,s.kt)("p",null,"The same endpoint used to retrieve the customer marketing preferences is also used to update. Only the method is different."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-http",metastring:"request",request:!0},"POST https://events.intilery.com/cdp/marketing-preferences/<subscription id>\n")),(0,s.kt)("h3",{id:"example-code"},"Example code"),(0,s.kt)("p",null,"The example POST below updates the example customers marketing preferences as follows:-"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Unsubscribe from the new_product_alerts subscription category"),(0,s.kt)("li",{parentName:"ul"},"Subscribe to the SMS channel\nNote that the category/channel fields match up to those in the retrieved preferences.\nWe recommend calling this endpoint from your servers to avoid any browser related CORS or blocking issues.")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},'const data = {\n    "categories": [{\n        "category": "marketing_tricks",\n        "subscribed": true\n    }, {\n        "category": "new_product_alerts",\n        "subscribed": false\n    }],\n    "channels": [{\n        "channel": "email",\n        "subscribed": true\n    }, {\n        "channel": "sms",\n        "subscribed": true\n    }],\n    "unsubscribeAll": false,\n    "unsubscribeReason": ""\n};\n$.ajax({\n    type: \'POST\',\n    url: `https://events.intilery.com/cdp/marketing-preferences/276db9bf-ac46-4dc3-bb7d-e94a7eb1de51`,\n    crossDomain: true,\n    contentType: \'application/json; charset=utf-8\',\n    data: JSON.stringify(data),\n    success: function () {\n        alert("marketing preferences updated");\n    }\n});\n')),(0,s.kt)("h3",{id:"campaign-reporting"},"Campaign Reporting"),(0,s.kt)("p",null,"To tie the unsubscribe/subscribe to a campaign for reporting, add the parameter",(0,s.kt)("inlineCode",{parentName:"p"},"?assetId=XXX")),(0,s.kt)("p",null,"The assetID can be found in the URL parameter ",(0,s.kt)("inlineCode",{parentName:"p"},"utm_campaign")),(0,s.kt)("p",null,"E.g. the for the url"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-http",metastring:"request",request:!0},"https://yourdomain.com/prefs?s<subscriptionId>&utm_campaign=July-1&utm_medium=email&utm_source=Intilery\n")),(0,s.kt)("p",null,"The assetId is ",(0,s.kt)("inlineCode",{parentName:"p"},"July-1")," you should POST to"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-http",metastring:"request",request:!0},"POST https://events.intilery.com/cdp/marketing-preferences/<subscription id>?assetId=July-1\n")),(0,s.kt)("h3",{id:"example-response-1"},"Example response"),(0,s.kt)("p",null,"The endpoint will return a 200 response to indicate success."),(0,s.kt)("h2",{id:"unsubscribing-from-all-communications"},"Unsubscribing from all communications"),(0,s.kt)("p",null,"Send the following data to the endpoint"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-json5"},'{\n    "categories": [],\n    "channels": [],\n    "unsubscribeAll": true,\n    "unsubscribeReason": "" // can be set to a string value to be recorded against the customer for your own records\n}\n')))}u.isMDXComponent=!0}}]);