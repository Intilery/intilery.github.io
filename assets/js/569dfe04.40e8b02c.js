(self.webpackChunkintilery=self.webpackChunkintilery||[]).push([[9550],{3905:function(e,n,t){"use strict";t.d(n,{Zo:function(){return p},kt:function(){return g}});var i=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function r(e,n){if(null==e)return{};var t,i,o=function(e,n){if(null==e)return{};var t,i,o={},a=Object.keys(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=i.createContext({}),c=function(e){var n=i.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},p=function(e){var n=c(e.components);return i.createElement(l.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},u=i.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,p=r(e,["components","mdxType","originalType","parentName"]),u=c(t),g=o,f=u["".concat(l,".").concat(g)]||u[g]||d[g]||a;return t?i.createElement(f,s(s({ref:n},p),{},{components:t})):i.createElement(f,s({ref:n},p))}));function g(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,s=new Array(a);s[0]=u;var r={};for(var l in n)hasOwnProperty.call(n,l)&&(r[l]=n[l]);r.originalType=e,r.mdxType="string"==typeof e?e:o,s[1]=r;for(var c=2;c<a;c++)s[c]=t[c];return i.createElement.apply(null,s)}return i.createElement.apply(null,t)}u.displayName="MDXCreateElement"},1075:function(e,n,t){"use strict";t.r(n),t.d(n,{frontMatter:function(){return r},contentTitle:function(){return l},metadata:function(){return c},toc:function(){return p},default:function(){return u}});var i=t(2122),o=t(9756),a=(t(7294),t(3905)),s=["components"],r={id:"ios-push",title:"iOS Push Notifications",sidebar_label:"iOS Push Notifications"},l=void 0,c={unversionedId:"sdk/ios-push",id:"sdk/ios-push",isDocsHomePage:!1,title:"iOS Push Notifications",description:"Setup",source:"@site/docs/sdk/ios-push.md",sourceDirName:"sdk",slug:"/sdk/ios-push",permalink:"/docs/sdk/ios-push",version:"current",frontMatter:{id:"ios-push",title:"iOS Push Notifications",sidebar_label:"iOS Push Notifications"},sidebar:"sdk",previous:{title:"iOS FAQs",permalink:"/docs/sdk/ios-faq"},next:{title:"Android Mobile SDK",permalink:"/docs/sdk/android"}},p=[{value:"Setup",id:"setup",children:[]},{value:"Registering devices",id:"registering-devices",children:[{value:"Registering iOS",id:"registering-ios",children:[]},{value:"Monitor For New Token iOS",id:"monitor-for-new-token-ios",children:[]}]},{value:"Receiving Messages",id:"receiving-messages",children:[{value:"Handle messages with method swizzling disabled",id:"handle-messages-with-method-swizzling-disabled",children:[]}]}],d={toc:p};function u(e){var n=e.components,t=(0,o.Z)(e,s);return(0,a.kt)("wrapper",(0,i.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"setup"},"Setup"),(0,a.kt)("p",null,"To send push notifictions to your app, we use ",(0,a.kt)("a",{parentName:"p",href:"https://firebase.google.com/"},"Google Firebase")," as the messaging SDKs. Google Firebase is the number 1 mobile platform."),(0,a.kt)("p",null,"In order to send messages from Intilery to your app you should follow the instructions for iOS ",(0,a.kt)("a",{parentName:"p",href:"https://firebase.google.com/docs/cloud-messaging/ios/client"},"setting up iOS notifications")),(0,a.kt)("p",null,"iOS you will need to register your app(s) with google firebase and supply Intilery with one of your FCM Keys for each app."),(0,a.kt)("h2",{id:"registering-devices"},"Registering devices"),(0,a.kt)("p",null,"For each customer device you will need to send the FCM token and optional deviceId to Intilery as part of an identify event, this registers the device to the customers' profile at Intilery."),(0,a.kt)("h3",{id:"registering-ios"},"Registering iOS"),(0,a.kt)("p",null,"Once you have completed the steps at ",(0,a.kt)("a",{parentName:"p",href:"https://firebase.google.com/docs/cloud-messaging/ios/client"},"setting up iOS notifications")," you can implement the firebase code and Intilery identify code to register the device to the customer."),(0,a.kt)("h4",{id:"swift"},"Swift"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-swift"},'if #available(iOS 10.0, *) {\n  // For iOS 10 display notification (sent via APNS)\n  UNUserNotificationCenter.current().delegate = self\n\n  let authOptions: UNAuthorizationOptions = [.alert, .badge, .sound]\n  UNUserNotificationCenter.current().requestAuthorization(\n    options: authOptions,\n    completionHandler: {_, _ in })\n} else {\n  let settings: UIUserNotificationSettings =\n  UIUserNotificationSettings(types: [.alert, .badge, .sound], categories: nil)\n  application.registerUserNotificationSettings(settings)\n}\n\napplication.registerForRemoteNotifications()\n\nAnalytics.shared().identify("a user\'s id", traits: [\n  "pushToken": "the token from firebase",\n  "deviceId" : "a meaningful name, e.g. company iOS App" //optional\n])\n\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Note:")," deviceId is optional but recommended, if not set, push notificatinos will be sent to all devices registered to a customer."),(0,a.kt)("h4",{id:"objective-c"},"Objective-C"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-objective-c"},'if ([UNUserNotificationCenter class] != nil) {\n  // iOS 10 or later\n  // For iOS 10 display notification (sent via APNS)\n  [UNUserNotificationCenter currentNotificationCenter].delegate = self;\n  UNAuthorizationOptions authOptions = UNAuthorizationOptionAlert |\n      UNAuthorizationOptionSound | UNAuthorizationOptionBadge;\n  [[UNUserNotificationCenter currentNotificationCenter]\n      requestAuthorizationWithOptions:authOptions\n      completionHandler:^(BOOL granted, NSError * _Nullable error) {\n        // ...\n      }];\n} else {\n  // iOS 10 notifications aren\'t available; fall back to iOS 8-9 notifications.\n  UIUserNotificationType allNotificationTypes =\n  (UIUserNotificationTypeSound | UIUserNotificationTypeAlert | UIUserNotificationTypeBadge);\n  UIUserNotificationSettings *settings =\n  [UIUserNotificationSettings settingsForTypes:allNotificationTypes categories:nil];\n  [application registerUserNotificationSettings:settings];\n}\n\n[application registerForRemoteNotifications];\n\n[[SEGAnalytics sharedAnalytics] identify:@"a user\'s id"\n                                traits:@{ @"pushToken": @"the token from firebase",\n                                          @"deviceId": @"a meaningful name, e.g. company iOS App"}];\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Note:")," deviceId is optional but recommended, if not set, push notificatinos will be sent to all devices registered to a customer."),(0,a.kt)("h3",{id:"monitor-for-new-token-ios"},"Monitor For New Token iOS"),(0,a.kt)("p",null,"You should implement code to monitor for a new token on the device, and send the token to Intilery."),(0,a.kt)("h4",{id:"swift-1"},"Swift"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-swift"},'func messaging(_ messaging: Messaging, didReceiveRegistrationToken fcmToken: String?) {\n  print("Firebase registration token: \\(String(describing: fcmToken))")\n\n  let dataDict:[String: String] = ["token": fcmToken ?? ""]\n  NotificationCenter.default.post(name: Notification.Name("FCMToken"), object: nil, userInfo: dataDict)\n  \n  Analytics.shared().identify("a user\'s id", traits: [\n  "pushToken": "the token from firebase",\n  "deviceId" : "a meaningful name, e.g. company iOS App" //optional\n])\n}\n')),(0,a.kt)("h4",{id:"objective-c-1"},"Objective-C"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-objective-c"},'- (void)messaging:(FIRMessaging *)messaging didReceiveRegistrationToken:(NSString *)fcmToken {\n    NSLog(@"FCM registration token: %@", fcmToken);\n    // Notify about received token.\n    NSDictionary *dataDict = [NSDictionary dictionaryWithObject:fcmToken forKey:@"token"];\n    [[NSNotificationCenter defaultCenter] postNotificationName:\n     @"FCMToken" object:nil userInfo:dataDict];\n    \n  [[SEGAnalytics sharedAnalytics] identify:@"a user\'s id"\n                                traits:@{ @"pushToken": @"the token from firebase",\n                                          @"deviceId": @"a meaningful name, e.g. company iOS App"}];\n}\n')),(0,a.kt)("h2",{id:"receiving-messages"},"Receiving Messages"),(0,a.kt)("p",null,"In order to notify Intilery of the receing of the message you need to implement the following as detaild ",(0,a.kt)("a",{parentName:"p",href:"https://firebase.google.com/docs/cloud-messaging/ios/receive#handle_messages"},"here")),(0,a.kt)("p",null,"Implement ",(0,a.kt)("inlineCode",{parentName:"p"},"AppDelegate application:didReceiveRemoteNotification:")," "),(0,a.kt)("h4",{id:"swift-2"},"Swift"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-swift"},'func application(_ application: UIApplication, didReceiveRemoteNotification userInfo: [AnyHashable: Any]) {\n  // If you are receiving a notification message while your app is in the background,\n  // this callback will not be fired till the user taps on the notification launching the application.\n  // TODO: Handle data of notification\n\n  // With swizzling disabled you must let Messaging know about the message, for Analytics\n  // Messaging.messaging().appDidReceiveMessage(userInfo)\n\n  // Print message ID.\n  if let messageID = userInfo[gcmMessageIDKey] {\n    print("Message ID: \\(messageID)")\n  }\n\n  // Print full message.\n  print(userInfo)\n}\n\nfunc application(_ application: UIApplication, didReceiveRemoteNotification userInfo: [AnyHashable: Any],\n                 fetchCompletionHandler completionHandler: @escaping (UIBackgroundFetchResult) -> Void) {\n  // If you are receiving a notification message while your app is in the background,\n  // this callback will not be fired till the user taps on the notification launching the application.\n  // TODO: Handle data of notification\n\n  // With swizzling disabled you must let Messaging know about the message, for Analytics\n  // Messaging.messaging().appDidReceiveMessage(userInfo)\n\n  // Print message ID.\n  if let messageID = userInfo[gcmMessageIDKey] {\n    print("Message ID: \\(messageID)")\n  }\n\n  // Print full message.\n  print(userInfo)\n  \n  //send to Intilery\n    Analytics.shared().track("Push Notification Received", properties: ["notificationId": messageID])\n  completionHandler(UIBackgroundFetchResult.newData)\n}\n')),(0,a.kt)("h4",{id:"objective-c-2"},"Objective-C"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-objective-c"},'- (void)application:(UIApplication *)application didReceiveRemoteNotification:(NSDictionary *)userInfo {\n  // If you are receiving a notification message while your app is in the background,\n  // this callback will not be fired till the user taps on the notification launching the application.\n  // TODO: Handle data of notification\n\n  // With swizzling disabled you must let Messaging know about the message, for Analytics\n  // [[FIRMessaging messaging] appDidReceiveMessage:userInfo];\n\n  // Print message ID.\n  if (userInfo[kGCMMessageIDKey]) {\n    NSLog(@"Message ID: %@", userInfo[kGCMMessageIDKey]);\n  }\n\n  // Print full message.\n  NSLog(@"%@", userInfo);\n}\n\n- (void)application:(UIApplication *)application didReceiveRemoteNotification:(NSDictionary *)userInfo\n    fetchCompletionHandler:(void (^)(UIBackgroundFetchResult))completionHandler {\n  // If you are receiving a notification message while your app is in the background,\n  // this callback will not be fired till the user taps on the notification launching the application.\n  // TODO: Handle data of notification\n\n  // With swizzling disabled you must let Messaging know about the message, for Analytics\n  // [[FIRMessaging messaging] appDidReceiveMessage:userInfo];\n\n  // Print message ID.\n  if (userInfo[kGCMMessageIDKey]) {\n    NSLog(@"Message ID: %@", userInfo[kGCMMessageIDKey]);\n  }\n\n  // Print full message.\n  NSLog(@"%@", userInfo);\n      \n  //Call Intilery\n  [[SEGAnalytics sharedAnalytics] track:@"Push Notification Received"\n                            properties:@{ @"notificationId": userInfo[kGCMMessageIDKey] }];\n\n  completionHandler(UIBackgroundFetchResultNewData);\n}\n')),(0,a.kt)("h3",{id:"handle-messages-with-method-swizzling-disabled"},"Handle messages with method swizzling disabled"),(0,a.kt)("p",null,"See the instructions ",(0,a.kt)("a",{parentName:"p",href:"https://firebase.google.com/docs/cloud-messaging/ios/receive#handle-swizzle"},"here")," and add the relevant code to call Intilery"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://slack-imgs.com/?c=1&o1=wi32.he32.si&url=https%3A%2F%2Fwww.gstatic.com%2Fdevrel-devsite%2Fprod%2Fve312520032ba2ac0c4d23f7b46fc670cbbe051886a2d1f04563a5e4768ad9787%2Ffirebase%2Fimages%2Ftouchicon-180.png",alt:"Firebase"}),(0,a.kt)("strong",{parentName:"p"},"Firebase")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("a",{parentName:"strong",href:"https://firebase.google.com/docs/cloud-messaging"},"Firebase Cloud Messaging"))),(0,a.kt)("p",null,"Firebase Cloud Messaging (FCM) is a cross-platform messaging solution that lets you reliably send messages at no cost."))}u.isMDXComponent=!0}}]);